<!DOCTYPE html>
<html lang="id">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Dicoding Stories - Platform berbagi cerita komunitas Dicoding"
    />
    <meta
      name="keywords"
      content="dicoding, stories, komunitas, berbagi cerita, foto"
    />
    <meta name="author" content="Dicoding" />
    <meta name="theme-color" content="#6366f1" />

    <link rel="shortcut icon" href="/favicon.png" />
    <title>Dicoding Stories</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />

    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <script type="module" src="/scripts/index.js"></script>
  </head>
  <body>
    <a href="#main-content" class="skip-link">
      <i class="fas fa-arrow-down" aria-hidden="true"></i>
      Lewati ke konten utama
    </a>

    <header role="banner">
      <div class="main-header container">
        <a class="brand-name" href="#/" aria-label="Beranda Dicoding Stories">
          <i class="fas fa-book-open" aria-hidden="true"></i>
          Dicoding Stories
        </a>

        <nav
          id="navigation-drawer"
          class="navigation-drawer"
          role="navigation"
          aria-label="Menu utama"
        >
          <div class="nav-header">
            <h2 class="nav-title">
              <i class="fas fa-compass" aria-hidden="true"></i>
              Navigasi
            </h2>
          </div>
          <ul id="nav-list" class="nav-list">
            <li>
              <a href="#/">
                <i class="fas fa-home" aria-hidden="true"></i>
                Beranda
              </a>
            </li>
            <li>
              <a href="#/add">
                <i class="fas fa-plus-circle" aria-hidden="true"></i>
                Tambah Story
              </a>
            </li>
            <li>
              <a href="#/about">
                <i class="fas fa-info-circle" aria-hidden="true"></i>
                Tentang
              </a>
            </li>
          </ul>
        </nav>

        <button
          id="drawer-button"
          class="drawer-button"
          aria-label="Buka menu navigasi"
          aria-expanded="false"
          aria-controls="navigation-drawer"
        >
          <i class="fas fa-bars" aria-hidden="true"></i>
        </button>
      </div>
    </header>

    <main id="main-content" class="main-content" role="main" tabindex="-1">
      <div class="page-loader" id="page-loader" style="display: none">
        <div class="loader-spinner">
          <i class="fas fa-spinner fa-spin"></i>
        </div>
        <p>Memuat halaman...</p>
      </div>
    </main>

    <div
      class="toast-container"
      id="toast-container"
      aria-live="polite"
      aria-atomic="true"
    ></div>

    <script>
      if ("startViewTransition" in document) {
        const originalPushState = history.pushState;
        const originalReplaceState = history.replaceState;

        history.pushState = function (...args) {
          document.startViewTransition(() => {
            originalPushState.apply(history, args);
            window.dispatchEvent(new PopStateEvent("popstate"));
          });
        };

        history.replaceState = function (...args) {
          document.startViewTransition(() => {
            originalReplaceState.apply(history, args);
            window.dispatchEvent(new PopStateEvent("popstate"));
          });
        };

        window.addEventListener("hashchange", (event) => {
          if (!event.detail?.skipTransition) {
            document.startViewTransition(() => {
              // Transition akan ditangani oleh event listener di app.js
            });
          }
        });
      }

      // Progressive Web App features
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("/sw.js")
            .then((registration) => {
              console.log("SW registered: ", registration);
            })
            .catch((registrationError) => {
              console.log("SW registration failed: ", registrationError);
            });
        });
      }

      // Toast notification system
      window.showToast = function (message, type = "info", duration = 3000) {
        const container = document.getElementById("toast-container");
        const toast = document.createElement("div");
        toast.className = `toast toast-${type}`;

        const icons = {
          success: "fas fa-check-circle",
          error: "fas fa-exclamation-circle",
          warning: "fas fa-exclamation-triangle",
          info: "fas fa-info-circle",
        };

        toast.innerHTML = `
          <i class="${icons[type]}" aria-hidden="true"></i>
          <span>${message}</span>
          <button class="toast-close" aria-label="Tutup notifikasi">
            <i class="fas fa-times" aria-hidden="true"></i>
          </button>
        `;

        container.appendChild(toast);

        // Auto remove
        setTimeout(() => {
          toast.classList.add("toast-fade-out");
          setTimeout(() => {
            if (container.contains(toast)) {
              container.removeChild(toast);
            }
          }, 300);
        }, duration);

        // Manual close
        toast.querySelector(".toast-close").addEventListener("click", () => {
          toast.classList.add("toast-fade-out");
          setTimeout(() => {
            if (container.contains(toast)) {
              container.removeChild(toast);
            }
          }, 300);
        });
      };
    </script>

    <style>
      .nav-header {
        padding: 16px 0 24px 0;
        border-bottom: 1px solid var(--border);
        margin-bottom: 16px;
      }

      .nav-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .page-loader {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        backdrop-filter: blur(4px);
      }

      .loader-spinner {
        font-size: 2rem;
        color: var(--primary);
        margin-bottom: 16px;
      }

      .toast-container {
        position: fixed;
        top: 90px;
        right: 20px;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .toast {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px 20px;
        background: var(--bg-primary);
        border-radius: var(--radius);
        box-shadow: var(--shadow-lg);
        border-left: 4px solid;
        min-width: 300px;
        transform: translateX(100%);
        animation: toastSlideIn 0.3s ease forwards;
      }

      .toast-success {
        border-left-color: var(--success);
      }
      .toast-error {
        border-left-color: var(--error);
      }
      .toast-warning {
        border-left-color: var(--warning);
      }
      .toast-info {
        border-left-color: var(--primary);
      }

      .toast-close {
        background: none;
        border: none;
        cursor: pointer;
        color: var(--text-muted);
        margin-left: auto;
        padding: 4px;
        border-radius: var(--radius-sm);
        transition: var(--transition);
      }

      .toast-close:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
      }

      .toast-fade-out {
        animation: toastSlideOut 0.3s ease forwards;
      }

      @keyframes toastSlideIn {
        to {
          transform: translateX(0);
        }
      }

      @keyframes toastSlideOut {
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }

      @media (max-width: 768px) {
        .toast-container {
          right: 12px;
          left: 12px;
        }

        .toast {
          min-width: auto;
        }
      }
    </style>
  </body>
</html>
